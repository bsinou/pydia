# SDK Kotlin

## Regenerate the SDK

We use [swagger-codegen](https://swagger.io/docs/open-source-tools/swagger-codegen/) to generate the Java client.

For the time being, we rather clone the repository in a temp location to generate the new version of
the code and then replace the `org.sinou.pydia.openapi` package in the local repository, to avoid
polluting the main repo with autogenerated files (gradle, doc, config files...)

### With OpenAPI 3

Note: you can check for new
release [here](https://github.com/OpenAPITools/openapi-generator/releases).

```sh
branch=sandbox
mkdir -p /tmp/forSwagger
cd /tmp/forSwagger
git clone https://github.com/bsinou/pydia.git
cd pydia
git checkout $branch
cd sdk-kotlin

cp ../../openapi-generator-cli.jar .
# or
GENERATOR_VERSION=7.4.0
wget https://repo1.maven.org/maven2/org/openapitools/openapi-generator-cli/${GENERATOR_VERSION}/openapi-generator-cli-${GENERATOR_VERSION}.jar -O openapi-generator-cli.jar

```

This is a manual tedious process:

- Retrieve Cells' JSON Swagger-V2 spec here:
  https://raw.githubusercontent.com/pydio/cells/main/common/proto/rest/cellsapi-rest.swagger.json
- Copy/paste specification file at: https://editor-next.swagger.io/
- Use Edit / convert to YAML
- Use Edit / convert to OpenAPI v3
- Paste back the resulting specifications in the sdk-kotlin root folder in cellsapi-rest.swagger.yml


Then generate the SDK

```sh
# WARNING: Update
SDK_DEFAULT_AGENT="PydioCells/v4.4.0-alpha2/KotlinSDK/v0.1.2"

java -jar openapi-generator-cli.jar generate -g kotlin -i ./cellsapi-rest.swagger.yml -o /tmp/forSwagger/pydia/sdk-kotlin     --invoker-package org.sinou.pydia.openapi     --api-package org.sinou.pydia.openapi.api     --model-package org.sinou.pydia.openapi.model     --http-user-agent ${SDK_DEFAULT_AGENT}

cd $GITPATH/github.com/bsinou/pydia/sdk-kotlin/src/main/kotlin/org/sinou/pydia/
rm -rf ./openapi/{model,api}
mv /tmp/forSwagger/pydia/sdk-kotlin/src/main/kotlin/org/sinou/pydia/openapi/ .

# Also copy used sagger file for later references
export CELLS_VERSION=4.4.0-alpha2
cp /tmp/forSwagger/pydia/sdk-kotlin/cellsapi-rest.swagger.yml $GITPATH/github.com/bsinou/pydia/sdk-kotlin/src/main/kotlin/org/sinou/pydia/openapi/cellsapi-rest-${CELLS_VERSION}.swagger.yml

# For the record, more details about the possible options:
java -jar swagger-codegen-cli.jar help generate
```

## Tmp extra steps

In nov 2023, we must also:

- retrieve infrastructure package and rename it:

```sh
cd $GITPATH/github.com/bsinou/pydia/sdk-kotlin/src/main/kotlin/org
mv /tmp/forSwagger/pydia/sdk-kotlin/src/main/kotlin/org/openapitools .
```

- refactor in our package