buildscript {

    ext {
        // Local variables (use def)
        def lifecycle_version = '2.6.2'
        def coroutines_android_version = '1.7.3'
        def room_version = '2.6.0'
        def work_version = '2.8.1'

        def appcompat_version = '1.6.1'
        def androidx_core_version = '1.12.0'
        def preference_version = '1.2.1'
        def splash_version = '1.0.1'

        def material_version = '1.10.0'

        // Compose versions is defined via platform BOM
        // We define here the versions of a few extra libraries that extend the Jetpack Compose features
        def navigation_version = '2.7.4'
        def compose_nav_version = '2.7.4'

        // Define All non-Android Third Party versions in a single place
        def aws_s3_sdk_version = '2.73.0'
        def glide_version = '5.0.0-rc01'
        def compose_glide_version = '1.0.0-beta01'
        def zxing_version = '3.5.2'
        def gson_version = '2.10.1'
        def commons_codec_version = '1.15'

        // Test libraries
        def junit_version = '4.13.2'
        def truth_version = '1.1.3'
        def robolectric_version = '4.9.2'
        def mockito_version = '5.1.1'
        def androidx_core_testing_version = '2.2.0'
        def androidx_test_version = '1.5.0'
        def androidx_test_runner_version = '1.5.2'
        def androidx_test_ext_version = '1.1.5'
        def espresso_version = '3.5.1'


        // Define dependency packages that are then used as shortcuts by the various modules.
        librariesKapt = [
                "androidx.room:room-compiler:2.6.0",
                "com.github.bumptech.glide:compiler:5.0.0-rc01",
        ]

        processors = [
                "com.github.bumptech.glide:compiler:5.0.0-rc01",
        ]

        libraries = [
                // Kotlin standard library and coroutines
                "org.jetbrains.kotlin:kotlin-stdlib:1.9.10",
                "org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3",
                "org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3",

                // Android UI and appcompat
                "androidx.core:core:1.12.0",
                "androidx.core:core-splashscreen:1.0.1",

//                "androidx.appcompat:appcompat:$appcompat_version",
                // Navigation UI
//                "androidx.navigation:navigation-ui-ktx:$navigation_version",
                // ViewModel
                "androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.2",
                // Extended UI features: prefs and splash screen
//                "androidx.preference:preference:$preference_version",
//                "androidx.core:core-splashscreen:$splash_version",

                // Material UI => we still need this to build custom palette based on remote server custom primary color
                "com.google.android.material:material:1.10.0",

                // Room for database, work for background
                "androidx.room:room-ktx:2.6.0",
                "androidx.work:work-runtime-ktx:2.8.1",

                // Dependency injection with Koin https://insert-koin.io/
                // We now use the Koin BOM
                "io.insert-koin:koin-core",
                "io.insert-koin:koin-android",
                "io.insert-koin:koin-androidx-workmanager",
                "io.insert-koin:koin-androidx-navigation",

                // Files
                "com.amazonaws:aws-android-sdk-s3:2.73.0",
                "com.github.bumptech.glide:glide:5.0.0-rc01",

                // Preferences
                "androidx.datastore:datastore-preferences:1.0.0",

                // Utils
//                "commons-codec:commons-codec:$commons_codec_version",
                "com.google.code.gson:gson:2.10.1",
                // QRCode generation
                "com.google.zxing:core:3.5.2",
        ]

        // We rely on a BOM to provide correct versions of the Jetpack Compose libraries.
        // See cells-client gradle config
        composeLibraries = [
                "androidx.compose.runtime:runtime",
                "androidx.compose.ui:ui",
                "androidx.compose.ui:ui-util",
                "androidx.compose.ui:ui-tooling",
                "androidx.compose.foundation:foundation",
                "androidx.compose.foundation:foundation-layout",
                "androidx.compose.material3:material3",
                "androidx.compose.material3:material3-window-size-class",
                // We use material 3, so remove remaining code that depend on this and remove the dep.
                "androidx.compose.material:material",
                // This library is also provided as an API dependency by androidx.compose.material:material.
                // We specify it explicitly so that we won't break when we finally remove material lib from
                // the explicit dependency tree
                "androidx.compose.material:material-icons-core",
                // this separate library, the full set of Material icons. Due to the very large size of this lib,
                // Make sure to use R8/Proguard to strip unused icons when including this as a direct dependency.
                // See https://developer.android.com/reference/kotlin/androidx/compose/material/icons/package-summary
                "androidx.compose.material:material-icons-extended",

                // Include extensions that permit integration of Compose with extra 3rd party libraries.
                "io.insert-koin:koin-androidx-compose",
                "androidx.navigation:navigation-compose:2.7.4",
                "com.github.bumptech.glide:compose:1.0.0-beta01",
        ]

//        testLibraries = [
//                // Junit 4
//                "junit:junit:$junit_version",
//
//                // Assertions
//                "com.google.truth:truth:$truth_version",
//
//                // Coroutines testing
//                "org.jetbrains.kotlinx:kotlinx-coroutines-test:$coroutines_android_version",
//
//                // Dependency injection with Koin
//                "io.insert-koin:koin-test",
//                "io.insert-koin:koin-test-junit4",
//
//                // Mocks
//                "org.mockito:mockito-core:$mockito_version",
//                "androidx.arch.core:core-testing:$androidx_core_testing_version",
//        ]

//        androidTestLibraries = [
//                // Koin for Test + JUnit 4
//                "junit:junit:$junit_version",
//                "io.insert-koin:koin-test",
//                "io.insert-koin:koin-test-junit4",
//
//                //  Androidx Testing
//                "androidx.arch.core:core-testing:$androidx_core_testing_version",
//                "androidx.test:runner:$androidx_test_runner_version",
//                "androidx.test:rules:$androidx_test_version",
//                "androidx.test.ext:junit:$androidx_test_ext_version",
//                "androidx.work:work-testing:$work_version",
//
//                // Coroutines testing
//                "org.jetbrains.kotlinx:kotlinx-coroutines-test:$coroutines_android_version",
//
//                // Espresso
//                "androidx.test.espresso:espresso-core:$espresso_version",
//                "androidx.test.espresso:espresso-contrib:$espresso_version",
//                "androidx.test.espresso:espresso-intents:$espresso_version",
//
//                "org.robolectric:robolectric:$robolectric_version",
//        ]
    }
}

plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android'
//    id 'com.android.library'
//    id 'kotlin-android'
    id 'kotlin-kapt'
    id 'kotlin-parcelize'
}

android {

    namespace 'org.sinou.pydia.client'

    compileSdk 34

    // Gather overrides in a distinct folder for easier maintenance
    // sourceSets.main.res.srcDir 'src/main/res-overrides'

    defaultConfig {
        applicationId "org.sinou.pydia.client.next"
        minSdk 24
        targetSdk 34
        versionCode 10
        versionName "0.2.1"

        testInstrumentationRunner 'androidx.test.runner.AndroidJUnitRunner'
    }

    buildTypes {
        debug {
            versionNameSuffix = '-dev'
            resValue "string", "app_version",
                    "${defaultConfig.versionName}${versionNameSuffix}"
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }

    buildFeatures {
        compose true
    }

    composeOptions {
        kotlinCompilerExtensionVersion = "1.5.3"
    }

    kapt {
        arguments {
            arg("room.schemaLocation", "$projectDir/schemas".toString())
        }
    }

    // We do not want that the linter makes builds fail. It is quite extremist by default.
    lintOptions {
        abortOnError false
    }
}

dependencies {

    api project(":sdk-kotlin")

    implementation platform('androidx.compose:compose-bom:2023.10.01')
    implementation platform('io.insert-koin:koin-bom:3.5.1')

    kapt librariesKapt
    implementation libraries
    implementation composeLibraries



    // override default platform version
    // e.G    implementation "androidx.compose.material3:material3:1.2.0-alpha1"

    // Enable custom data loader for glide library (display images)
    // annotationProcessor processors

    testImplementation platform('io.insert-koin:koin-bom:3.5.1')

}
